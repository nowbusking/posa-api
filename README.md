---
layout: page
title: 도도포인트 POS 보조 API 개요
permalink: /
---

도도포인트는 태블릿 기반의 포인트 적립 서비스입니다. 매장 카운터 앞에 도도포인트 태블릿을 두고, 손님이
결제할 때 포인트 적립을 하게 됩니다. 이 때, 실제 계산이 POS를 통해 이뤄질 때 적립이 가능하도록
도도포인트와 POS 사이의 연동이 필요합니다.

도도포인트는 POS와 연동 없이도 독립적으로 동작하지만, 연동하지 않을 경우 다음과 같은 문제가 존재합니다.

- 실제 매출과 무관하게 포인트 적립을 할 수 있습니다.
- 매번 포인트를 직접 입력해야 합니다.

POS와 연동하여 실제 계산을 할 때 *자동으로* 포인트 적립이 이뤄진다면 이러한 문제를 해결할 수 있습니다.
연동해야 하는 기능은 다음 두 종류입니다.

- [적립](#claim)
- [적립 취소](#cancel)

도도포인트 자체의 사용법에 대해서는 [도도스토어 매뉴얼][1]을 참고하세요.

[1]: http://dodo-landing.herokuapp.com/manual/text


시스템 개요
-----------

다음은 시스템의 개요도입니다.

![시스템 개요도](https://docs.google.com/drawings/d/1F6XemPm25l931-zP8SOxlseX53BS6bzFmthkjstSci8/pub?w=719&h=458)

이 문서에서 다루는 것은 위 개요도에서 `dpa.dll`에 해당하는, *POS 보조 API* 부분입니다.
*POS 보조 API*는 POS 소프트웨어 쪽에서 도도 *POS 보조 프로그램*과 연동하기 위한 통신 방식입니다.


적립                                                                   {#claim}
----

POS 연동을 *하지 않을 경우* 적립은 다음과 같은 절차로 이뤄지게 됩니다.

1. 손님이 결제를 합니다.
2. 이 때 매장 점원은 고객에게 포인트 적립을 권유하기 위해, POS 기기에 켜져있는 도도 POS 보조 프로그램을
   사용해 *포인트를 설정*하여 태블릿에 *적립 권유 요청*을 보냅니다.
3. 태블릿의 도도스토어 화면이 적립 화면으로 전환되며, 손님은 포인트 숫자를 확인 후 포인트를 적립합니다.

![미연동시 적립 흐름도](https://docs.google.com/drawings/d/1NhpCiHlBznVEfvoLfQCUushms2IacUMt5l-puI-B9n8/pub?w=719&h=458)

POS *연동을 할 경우* 점원은 *포인트를 설정하지 않고* 별도 조작 없이 태블릿에 바로 적립 권유를 하게
됩니다.

1. 손님이 결제를 합니다.
2. POS는 매출 데이터를 *POS 보조 API*를 통해 *도도 POS 보조 프로그램*에 전달합니다.
   (이때, POS는 각 결제의 고유한 식별자를 임의로 정해서 함께 전달합니다. 이 식별자는 나중에
   결제 취소가 필요할 때 [적립도 함께 취소하기 위해](#cancel) 사용됩니다.)
3. 도도 *POS 보조 프로그램*은 매출 데이터를 확인하여 *포인트를 자동으로 설정*한 뒤 태블릿에
   *적립 권유 요청*을 보냅니다.
4. 태블릿의 도도스토어 화면이 적립 화면으로 전환되며, 손님은 포인트 숫자를 확인 후 포인트를 적립합니다.

![연동시 적립 흐름도](https://docs.google.com/drawings/d/1eWmGh5r2A__2S0xZRex_aDgbHq6AEUf3Az85BJWh1ek/pub?w=719&h=458)


적립 취소                                                        {#cancel}
---------

POS 연동을 *하지 않을 경우* 적립 취소는 다음과 같은 절차로 이뤄지게 됩니다.

1. 손님이 결제 취소를 요구합니다.
2. 매장 점원은 POS에서 결제 취소 처리를 합니다.
3. 결제시 적립했던 포인트를 무효화하기 위해, POS 기기에 켜져있는 도도 POS 보조 프로그램을 사용해
   *결제시 적립했던 포인트를 0으로 수정*합니다.

![미연동시 적립 취소 흐름도](https://docs.google.com/drawings/d/15cd2WgnRrMCbRdlBIAYjT7eO4mmZmnzGL52xe_rRzko/pub?w=719&h=458)

POS *연동을 할 경우* 점원은 POS에서 *결제 취소 처리만* 하면 포인트 적립도 함께 자동으로 무효화 처리되게
됩니다.

1. 손님이 결제 취소를 요구합니다.
2. 매장 점원은 POS에서 결제 취소 처리를 합니다.
3. POS는 결제 취소 처리를 할 때 *POS 보조 API*를 통해 결제 취소 사실을
   도도 *POS 보조 프로그램*에 전달합니다. (이 때, 어떤 결제가 취소된 것인지 확인하기 위해
   앞서 [적립](#claim) 연동시 전달했던 *고유 결제 식별자*를 전달합니다.)
4. *POS 보조 프로그램*은 취소 처리된 결제에 해당하는 적립 사실을 무효화합니다.

![연동시 적립 취소 흐름도](https://docs.google.com/drawings/d/1vNdd6RgIQWiBuYRLlnjOA2GT8fTXnZqXYTAVx3Pdvf4/pub?w=719&h=458)
